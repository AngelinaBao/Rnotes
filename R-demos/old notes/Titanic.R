-#Titanic????????????????????????
  #???????????????????????????
  library("ggplot2") #?????????
library("ggthemes") #ggplot2??????????????????
library("scales") #???????????????
library("dplyr") #??????????????????
library("mice") #??????????????????
library("randomForest") #????????????????????????
#???????????????????????????????????????,??????????????????????????????????????????????????????????????????
train <- read.csv("D:/R/train.csv", stringsAsFactors = F)
test <- read.csv("D:/R/test.csv", stringsAsFactors = F)
full <-  bind_rows(train,test)
#??????????????????????????????????????????str?????????????????????????????????R?????????????????????
str(full) 
#?????????12?????????,1309????????????
#???????????????????????????????????????????????????,??????????????????????????????????????????????????????????????????
#summary??????????????????????????????????????????????????????????????????????????????????????????????????????
summary(full$Pclass)
summary(full$Age)
summary(full$SibSp)
summary(full$Parch)
summary(full$Fare)
#?????????????????????????????????,Age???263????????????,Fare???1????????????
#???????????????????????????,????????????????????????????????????,????????????????????????
na_fun <- function(x){
  i <- 1
  na_x <- 0
  while (i <= nrow(full)) {
    if (x[i] == "") {
      na_x <- na_x + 1
    }
    i = i + 1
  }
  return(na_x)
}
#???????????????????????????????????????????????????
na_fun(full$Name)
na_fun(full$Sex)
na_fun(full$Ticket)
na_fun(full$Cabin)
na_fun(full$Embarked)
#??????Name???Sex???Ticket????????????0,Cabin????????????1014???,Embarked????????????2??????Cabin???????????????,??????????????????????????????78%,???????????????????????????????????????
#??????Cabin??????
newfull <- select(full, -Cabin)
#???????????????Age???Fare???Embarked????????????????????????
#Age????????????????????????,????????????????????????
mice_mod <- mice(newfull[, !names(newfull) %in% c("PassengerId", "Name", "Survived")], method = "rf")
mice_output <- complete(mice_mod)
newfull$Age <- mice_output$Age
#Fare???Embarked????????????????????????????????????(?????????)??????
#?????????????????????
which(is.na(newfull$Fare))
which(newfull$Embarke == "")
newfull$Fare[1044] <- as.numeric(median(newfull$Fare, na.rm = TRUE))
newfull$Embarked[c(62, 830)] <- "C"
#???????????????????????????????????????
complete.cases(newfull)
#???????????????891???????????????????????????,??????????????????????????????????????????Survivedz???????????????
#?????????????????????????????????,????????????????????????????????????,??????????????????????????????
#??????,???Name??????????????????????????????,?????????Name????????????????????????,???????????????Title
newfull$Name <- as.character(newfull$Name)
newfull$Title <- sapply(newfull$Name, FUN = function(x){strsplit(x, split = "[,.]")[[1]][2]})
#[,.]?????????????????????????????????,.?????????,???????????????????????????,.[[1]]??????????????????,[2]????????????????????????????????????
#???Title?????????????????????
newfull$Title <- sub(" ", "", newfull$Title)
#???Title????????????
officer <- c("Capt","Col", "Don", "Dr", "Major", "Rev")
royalty <- c("Dona","Lady","the Countess", "Sir", "Jonkheer")
newfull$Title[newfull$Title == "Mlle"] <- "Miss"
newfull$Title[newfull$Title == "Ms"] <- "Miss"
newfull$Title[newfull$Title == "Mme"] <- "Mrs"
newfull$Title[newfull$Title %in% royalty] <- "Royalty"
newfull$Title[newfull$Title %in% officer] <- "Officer"
#??????????????????????????????
newfull$Fsize <- newfull$SibSp + newfull$Parch + 1
#?????????????????????????????????
newfull$FsizeD[newfull$Fsize == 1] <- "Single"
newfull$FsizeD[newfull$Fsize > 1 & newfull$Fsize <= 5] <- "Small"
newfull$FsizeD[newfull$Fsize > 5] <- "Large"
#?????????????????????
newfull$Child[newfull$Age < 18] <- "Child"
newfull$Child[newfull$Age >= 18] <- "Adult"
#???????????????????????????
factor_vars <- c("PassengerId", "Pclass", "Sex", "Embarked", "Title", "FsizeD", "Child")
newfull[factor_vars] <- lapply(newfull[factor_vars], function(x) as.factor(x))
#???????????????
train <- newfull[1:891,]
test <- newfull[892:1309,]
#????????????????????????,?????????????????????????????????????????????,?????????????????????????????????????????????
#re_model <- randomForest(factor(Survived) ~ Pclass + Sex + Age + SibSp + Parch + Fare + Embarked + FsizeD + Title + Child, data = train)
re_model <- randomForest(factor(Survived) ~ Title + Sex + Fare + Pclass + FsizeD + Child + Embarked, data = train)
#????????????????????????
plot(re_model, ylim = c(0, 0.36))
legend("topright", colnames(re_model$err.rate), col = 1:3, fill = 1:3)
#???test?????????????????????
prediction <- predict(re_model, test)
#?????????????????????????????????,??????????????????PassengerId???Survived(prediction).
solution <- data.frame(PassengerID = test$PassengerId, Survived = prediction)
#??????????????????????????????
write.csv(solution, file = "D:/R/my_rf_mod_Solution10.csv", row.names = F)